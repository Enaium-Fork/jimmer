---
sidebar_position: 1
title: 教程介绍 
---

:::tip
对于中文版，从本文档中挑取最重要的一部分，形成[B站视频集](https://www.bilibili.com/video/BV1dA4y1R7pV/?vd_source=60313648ad86e28e629f98e944f7fa2a)
:::

前言

jimmer分为两个部分，jimmer-core和jimmer-sql。

1. jimmer-core: 不可变数据
2. jimmer-sql: 基于jimmer-core的ORM

各自职责如下

## 第一部分：强大的只读数据模型

为Java移植知名项目[immer](https://github.com/immerjs/immer)，以可变对象的方式修改不可变对象。这是所有编程技术中处理只读对象最强大的方案。

Jimmer可以在需要使用不可变数据结构的任何上下文中使用，用于取代java record。不可变的数据结构允许（有效的）变化检测：如果对对象的引用没有改变，那么对象本身也没有改变。此外，它使克隆相对便宜：数据树的未更改部分不需要复制，并且在内存中与相同状态的旧版本共享。

一般来说，这些好处可以通过确保您永远不会更改对象、数组或映射的任何属性来实现，而是始终创建一个更改后的副本。在实践中，这可能会导致代码编写起来非常麻烦，并且很容易意外违反这些约束。 Jimmer将通过解决以下痛点来帮助您遵循不可变数据范式：

1. Jimmer 将检测到意外突变并抛出错误。
2. Jimmer 将不再需要创建对不可变对象进行深度更新时所需的典型样板代码：如果没有Jimmer，则需要在每个级别手动制作对象副本。通常通过使用大量拷贝构造。
3. 使用JImmer时，会对草稿对象进行更改，该对象会记录更改并负责创建必要的副本，而不会影响原始对象。

使用Jimmer时，您无需学习专用API或数据结构即可从范例中受益。

另外，为了支持ORM，Jimmer在immer的基础上增加了对象的动态性。对象的任何属性都允许缺失。
- 缺失的属性在被代码直接访问时会导致异常
- 缺失的属性在Jackson序列化过程中会被自动忽略，不会导致异常

## 第二部分：基于不可变数据模型的革命性的ORM

1. 和JPA Criteria, QueryDSL以及JOOQ一样，强类型的SQL SDL，力求在编译时发现SQL错误，而非运行时、调试时、测试时。

:::tip
其中，kotlin专用的API会为SQL引入kotlin的空安全
:::

2. 强类型SQL DSL和Native SQL可以自由混编，鼓励使用数据库特有功能。

3. 永远使用高性能的[ResultSet.getObject(int)](https://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html#getObject(int))；而非相对低效的[ResultSet.getObject(String)](https://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html#getObject(java.lang.String))

4. 隐式的动态的表连接，在复杂的动态查询实现中，自动合并不同代码逻辑分支中冲突的表连接 *（即便使用以可控性很强的myBatis，也难以实现此功能）*

5. 通用的分页查询需要两条SQL，一条查数据，一条查行数。开发人员负责前者，后者由框架自动生成，自动优化。

6. **对象抓取器**：扩展SQL的能力，如果查询中某列是对象类型，可以指定为对象的查询格式，接受任意的关联深度和广度、甚至可以递归查询自关联属性。可以认为SQL被扩展到足够强大的的形态，具备和GraphQL相媲美的能力。

7. **Sava指令**：被保存（插入或修改）的数据不再是简单的对象，而是一颗任意复杂的对象树。无论这棵树有多复杂，框架负责所有内部细节，开发人员只需一句话即可完成整体操作。这个功能是对象抓取器的逆功能。

8. 可外接任何缓存系统。默认情况下无缓存，只是一个非常轻量而强大的SQL生成器；但是用户可以挂接任何缓存，**并和业务系统的自身缓存技术保持一致**。和其他ORM不同，不仅支持对象缓存，而且支持关联缓存，且对对象抓取器有效，尤其是递归查询自关联属性时。

  > 这是一个新加的功能，目前暂时没有更细节的文档，会尽快补充。

9. 非常轻量，内部实现比myBatis还轻量，无任何反射行为，无任何动态字节码生成行为，保证graal友好

## 其他特色

1. Spring Boot 2.7引入了Spring GraphQL，为其提供快速开发支持

2. 不可变对象的动态性为用户带来了有益的副作用和全新的设计哲学

   在信息管理类软件开发过程中，HTTP API往往交互仅包含单向关联的对象树。即便所依赖的JSON序列化技术有一定的双向关联处理能力，人们也不会用。

   因此在模块API设计时，DTO就很重要，因为每个业务所需的DTO明确定义了聚合根。DTO设计成为业务设计和开发的先决条件。

   Jimmer的不可变对象具备动态性。虽然在ORM实体类型设计时，可以定义双向关联；但是针对具体业务场景创建对象时，Jimmer保证对象实例之间只有单向关联，任何尝试在对象实例之间建立双向关联的尝试都将导致异常。

   即，聚合根的设计，从系统API设计时，被推迟到特定业务场景创建对象时。自然不再必须基于DTO进行设计和开发，完全以实体对象作为开发基础成为可能，且开发过程非常自然。

   当然，这样的设计理念并非要完全否认DTO的价值，如果认为用静态的DTO设计对外API比用动态实体设计对外API更安全更清晰，你仍然可以选这是用DTO做一层最终封装。但是，这是一个锦上添花的选择，而不再是一个必须实施的选择。
